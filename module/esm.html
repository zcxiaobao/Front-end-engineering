<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>群雄逐鹿，前端模块化的未来在何方 | 前端工程化打怪升级手册</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="开局一条狗，如何征服工程化">
    
    <link rel="preload" href="/front-end-engineering-handbook/assets/css/0.styles.4d68ed8c.css" as="style"><link rel="preload" href="/front-end-engineering-handbook/assets/js/app.a64d5fad.js" as="script"><link rel="preload" href="/front-end-engineering-handbook/assets/js/3.e17cbad9.js" as="script"><link rel="preload" href="/front-end-engineering-handbook/assets/js/1.45b034b9.js" as="script"><link rel="preload" href="/front-end-engineering-handbook/assets/js/14.e80d8315.js" as="script"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/10.1c36d85b.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/11.59096481.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/12.2f6247a0.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/13.5b88f3c4.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/15.1a4bb958.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/16.2af617f6.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/4.396f0bf8.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/5.497640ae.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/6.735b6bed.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/7.3e29ab9c.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/8.adbd1ce3.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/9.a792d7fc.js">
    <link rel="stylesheet" href="/front-end-engineering-handbook/assets/css/0.styles.4d68ed8c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-349e681a><div data-v-349e681a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-b3e6ef50 data-v-349e681a data-v-349e681a><h3 class="title" data-v-b3e6ef50>前端工程化打怪升级手册</h3> <p class="description" data-v-b3e6ef50>开局一条狗，如何征服工程化</p> <label id="box" class="inputBox" data-v-b3e6ef50><input type="password" value="" data-v-b3e6ef50> <span data-v-b3e6ef50>Konck! Knock!</span> <button data-v-b3e6ef50>OK</button></label> <div class="footer" data-v-b3e6ef50><span data-v-b3e6ef50><i class="iconfont reco-theme" data-v-b3e6ef50></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-b3e6ef50>vuePress-theme-reco</a></span> <span data-v-b3e6ef50><i class="iconfont reco-copyright" data-v-b3e6ef50></i> <a data-v-b3e6ef50><!---->
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-349e681a><header class="navbar" data-v-349e681a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/front-end-engineering-handbook/" class="home-link router-link-active"><!----> <span class="site-name">前端工程化打怪升级手册</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/front-end-engineering-handbook/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      战场小包
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zcxiaobao" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/4424090519078430" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-349e681a></div> <aside class="sidebar" data-v-349e681a><div class="personal-info-wrapper" data-v-1bfe3fa5 data-v-349e681a><!----> <!----> <div class="num" data-v-1bfe3fa5><div data-v-1bfe3fa5><h3 data-v-1bfe3fa5>7</h3> <h6 data-v-1bfe3fa5>文章</h6></div> <div data-v-1bfe3fa5><h3 data-v-1bfe3fa5>0</h3> <h6 data-v-1bfe3fa5>标签</h6></div></div> <ul class="social-links" data-v-1bfe3fa5></ul> <hr data-v-1bfe3fa5></div> <nav class="nav-links"><div class="nav-item"><a href="/front-end-engineering-handbook/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      战场小包
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zcxiaobao" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/4424090519078430" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/front-end-engineering-handbook/module/origin" class="sidebar-heading clickable open"><span>基础部分</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/front-end-engineering-handbook/module/origin.html" class="sidebar-link">模块化前世今生</a></li><li><a href="/front-end-engineering-handbook/module/esm.html" aria-current="page" class="active sidebar-link">前端模块化未来探索</a></li><li><a href="/front-end-engineering-handbook/module/pure-esm.html" class="sidebar-link">Pure ESM &amp; Dual Packages</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-b3e6ef50 data-v-349e681a><h3 class="title" data-v-b3e6ef50>群雄逐鹿，前端模块化的未来在何方</h3> <!----> <label id="box" class="inputBox" data-v-b3e6ef50><input type="password" value="" data-v-b3e6ef50> <span data-v-b3e6ef50>Konck! Knock!</span> <button data-v-b3e6ef50>OK</button></label> <div class="footer" data-v-b3e6ef50><span data-v-b3e6ef50><i class="iconfont reco-theme" data-v-b3e6ef50></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-b3e6ef50>vuePress-theme-reco</a></span> <span data-v-b3e6ef50><i class="iconfont reco-copyright" data-v-b3e6ef50></i> <a data-v-b3e6ef50><!---->
          
        <!---->
        2023
      </a></span></div></div> <div data-v-349e681a><div data-v-349e681a><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">群雄逐鹿，前端模块化的未来在何方</h1> <div data-v-0b291498><i class="iconfont reco-account" data-v-0b291498><span data-v-0b291498>战场小包</span></i> <i class="iconfont reco-date" data-v-0b291498><span data-v-0b291498>2021/3/29</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h2 id="写在前面"><a href="#写在前面" class="header-anchor">#</a> 写在前面</h2> <blockquote><p>本篇是前端工程化打怪升级的第 2 篇， <a href="https://zcxiaobao.github.io/front-end-engineering-handbook/module/esm.html" target="_blank" rel="noopener noreferrer"><strong>小册传送门</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> | <a href="https://github.com/zcxiaobao/front-end-engineering-handbook/tree/main/code/2.module" target="_blank" rel="noopener noreferrer"><strong>案例代码</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>首先我们来回忆一下早期模块化的探索历程: 最初文件划分方式实现简单的代码逻辑划分 --&gt; 命名空间方式减少命名冲突 --&gt; IIFE 构建私有作用域 --&gt; IIFE 引入依赖实现简单的依赖管理 --&gt; 依赖注入降低模块依赖间的耦合度</p> <p>从早期模块化的探索历程中，大抵可以总结出模块化的核心诉求: <strong>命名冲突、依赖管理、全局污染</strong>。模块化并非一个孤立概念，不能将模块化脱离工程化，模块化的内涵也要追溯到降本提效上，因此在我看来，一个完善的模块化要具备下列几部分:</p> <img src="/front-end-engineering-handbook/images/waht-module.png" alt="what module"> <p>模块化方法经过多番演变，正在迈向成熟的路上，未来方案不再遥不可及，那就是 <code>ESModule</code>。</p> <p><strong>为何说 <code>ESModule</code> 是前端模块化的未来，ESModule 又有那些独特优势？</strong></p> <p>本文将围绕上述问题，带你理解</p> <ul><li>现代模块化规范 <code>Commonjs</code>、<code>AMD</code>、<code>CMD</code>、<code>ESModule</code> 规范有何异同，又各自具备何种特点</li> <li>主流规范大 PK: <code>Commonjs</code> 规范 VS <code>ESModule</code> 规范，</li> <li>面向未来的模块化规范 <code>ESModule</code> 底气何在</li></ul> <p>接下来将为你一次一次揭晓，如果想迅速知晓答案，可传送至<a href="#%E6%80%BB%E7%BB%93">总结篇</a>查看思维导图。</p> <h2 id="commonjs-规范"><a href="#commonjs-规范" class="header-anchor">#</a> Commonjs 规范</h2> <h3 id="基本使用"><a href="#基本使用" class="header-anchor">#</a> 基本使用</h3> <p><code>Commonjs</code> 是业界最早提出的模块化规范，主要应用于服务器端，Nodejs 的模块系统便是 <code>Commonjs</code> 规范的最佳践行者。</p> <p><code>Commonjs</code> 模块化规范实现围绕四个核心环境变量:</p> <ul><li><code>module</code>: 每个模块内部都存有 <code>module</code> 对象代表当前模块</li> <li><code>exports</code>: 通过 <code>exports</code>(或 <code>module.exports</code>) 暴露模块内部属性</li> <li><code>require</code>: 使用 <code>require</code> 来实现模块加载</li> <li><code>global</code>: 全局上下文环境</li></ul> <p>学会核心四大环境变量后，<code>Commonjs</code> 规范就简单多了:</p> <ul><li>每一个文件就是一个模块，拥有自己独立的作用域。</li> <li>模块内部定义变量以及方法等都是私有的，对外界不可见。</li> <li><code>module</code> 对象的 <code>exports</code>(或 <code>module.exports</code>) 属性是对外的接口，加载某个模块，实际上就是加载该模块的 <code>module.exports</code> 属性(不推荐直接使用 <code>exports</code>)</li> <li>使用 require 加载模块</li></ul> <p><code>Commonjs</code> 使用起来比较简单，下面咱们来尝试一下:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 导出模块</span>
<span class="token comment">// moduleA.js</span>
<span class="token keyword">const</span> moduleName <span class="token operator">=</span> <span class="token string">&quot;moduleA&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  moduleName<span class="token punctuation">,</span>
  add<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 加载模块</span>
<span class="token comment">// entry.js</span>
<span class="token keyword">const</span> moduleA <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./moduleA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moduleA<span class="token punctuation">.</span>moduleName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// moduleA</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moduleA<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
</code></pre></div><h3 id="核心要点"><a href="#核心要点" class="header-anchor">#</a> 核心要点</h3> <blockquote><p><strong>Tips1: require 加载模块，本质上就是读取 module.exports 属性，exports 也可以实现导出功能，但通常不推荐使用</strong></p></blockquote> <p><code>module.exports</code> 和 <code>exports</code> 在模块中默认情况下<strong>指向同一地址空间，等价；但若后续发生地址层面的修改，两者就会产生差异，造成导出内容存在问题。</strong></p> <p>下面咱们来模拟一个简单场景: Mary 要去找 Tom 玩，但她不知道 Tom 家在哪里，只知道 Tom 的 name 和 height，module.exports 和 exports 先生是 Tom 的邻居，因此 Mary 通过 Tom 邻居的信息来寻找 Tom。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Mary.js</span>
<span class="token keyword">const</span> Tom <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./Tom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>Tom<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;Tom&quot;</span> <span class="token operator">&amp;&amp;</span> Tom<span class="token punctuation">.</span>height <span class="token operator">===</span> <span class="token number">180</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;成功找到 Tom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;未能找到 Tom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>第一种情形: <code>module.exports</code> 和 <code>exports</code> 分别提供了一条线索</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Tom.js</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Tom&quot;</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">180</span><span class="token punctuation">;</span>
</code></pre></div><img src="/front-end-engineering-handbook/images/common-exports.png" alt="module.exports"> <p>第二种情形: <code>module.exports</code> 指向了另一个重名 Tom，而 <code>exports</code> 仍指向原来的 Tom，<code>require</code> 默认读取 <code>module.exports</code>， Mary 最终只获取了同名 Tom 的 name 信息。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Tom&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">180</span><span class="token punctuation">;</span>
</code></pre></div><img src="/front-end-engineering-handbook/images/common-exports-2.png" alt="module.exports"> <p>第三种情形: <code>exports</code> 指向了另一个 Tom，而 <code>require</code> 获取 <code>module.exports</code> 上接口，因此 <code>exports</code> 提供的线索一律不予采纳。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;Tom&quot;</span><span class="token punctuation">;</span>
exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">180</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><img src="/front-end-engineering-handbook/images/common-exports-3.png" alt="module.exports"> <p><code>module.exports</code> 与 <code>exports</code> 全部指向新空间类似于第二种情形，这里不做描述了。</p> <blockquote><p>Tips2: <code>Commonjs</code> 模块输出的是值的拷贝，对于原始类型，复制其值，模块内部的变化不会影响导出值；对于引用类型为浅复制，属性的变动会影响导出值。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// moduleA.js</span>
<span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  count<span class="token operator">++</span><span class="token punctuation">;</span>
  obj<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">alterObj</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">newCount</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> add<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> alterObj <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// entry.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> add<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> alterObj <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./moduleA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;count: &quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">,</span> <span class="token string">&quot; obj.count:&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// count:  0  obj.count: 0</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;count: &quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">,</span> <span class="token string">&quot; obj.count:&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// count:  0  obj.count: 1</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;obj&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// obj { count: 1 }</span>
<span class="token function">alterObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;obj&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// obj { count: 1 }</span>
</code></pre></div><p>通过上述案例，<code>Commonjs</code> 引用的机制非常类似于 ES6 const 语法，基本类型不会变化，引用类型只会发生属性级别的变化。</p> <blockquote><p>Tips3: 模块存在缓存机制，第一次加载后模块会被缓存，因此多次重复引用或加载会读取缓存</p></blockquote> <blockquote><p>Tips4: 模块加载采用同步方式</p></blockquote> <p><code>Commonjs</code> 应用于服务端，模块存放在本地磁盘上，不需要进行网络 I/O，读取速度特别快；此外，服务端启动后通常会一直运行，模块读取只发生在服务启动阶段，这种模式并不会影响服务的性能。而在浏览器端则存在大量的异步操作，使用 <code>Commonjs</code> 规范会造成浏览器 JS 解析过程的阻塞，严重影响页面加载速度。</p> <p>可见 <code>Commonjs</code> 并不适用于浏览器端，因此业界后续又设计出了全新的异步加载规范应用于浏览器端，下面来依次介绍一下。</p> <blockquote><p>对于 <code>Commonjs</code> 的具体实现，将通过单独一章详细进行讲解。</p></blockquote> <h2 id="amd-规范"><a href="#amd-规范" class="header-anchor">#</a> AMD 规范</h2> <h3 id="基本使用-2"><a href="#基本使用-2" class="header-anchor">#</a> 基本使用</h3> <p><code>AMD</code> 全称为 <code>Asynchronous Module Definition</code>，即异步模块定义规范。借助该规范，浏览器端可以实现模块异步加载，避免同步加载的页面阻塞。</p> <p><code>AMD</code> 规范是一种标准，没有得到浏览器端的原生支持，使用它需要借助第三方实现，<a href="https://github.com/requirejs/requirejs" target="_blank" rel="noopener noreferrer">requireJS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是最经典的库，其完整实现了 <code>AMD</code> 规范，后续的使用基于 requireJS。</p> <p><code>requireJS</code> 提供了三个核心方法</p> <ul><li><code>define</code> 定义模块</li> <li><code>require</code> 加载模块</li> <li><code>require.config</code> 指定引用路径</li></ul> <p>下面来建立一个项目，项目结构如下:</p> <div class="language- extra-class"><pre class="language-text"><code>├── index.html
├── scripts
│   ├── utils.js
│   |   └── print.js
│   ├── require.js
│   └── entry.js
</code></pre></div><p>然后看一下具体使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 网页中引入 requirejs 以及模块入口</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./scripts/require.js&quot;</span> data<span class="token operator">-</span>main<span class="token operator">=</span><span class="token string">&quot;./scripts/entry&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment">// entry.js</span>
require<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">baseUrl</span><span class="token operator">:</span> <span class="token string">&quot;scripts/utils&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;print&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">printModule</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  printModule<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;entry&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// print.js</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">print</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;print &quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>更多使用请参考 <a href="https://requirejs.org/docs/start.html" target="_blank" rel="noopener noreferrer">requirejs 文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="核心要点-2"><a href="#核心要点-2" class="header-anchor">#</a> 核心要点</h3> <p>回看 <code>requireJS</code> 的模块加载方式，是不是有几分眼熟，没错，这里的思想类似于上一篇文章中的<strong>依赖注入</strong>思想。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;print&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">printModule</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  printModule<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;entry&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>但在 <code>requireJS</code> 中，有一个更标准的称呼——依赖前置。依赖前置是 <code>AMD</code> 的核心设计思想，<code>AMD</code> 通过<strong>动态创建 script 标签的方式来异步加载模块</strong>，加载完成后立即执行该模块，所有的依赖加载并执行完毕后，本模块才会执行。</p> <p>基于依赖前置的 <code>requireJS</code> 成功实现了异步模块加载，同时也暴露出很多问题</p> <ul><li><code>AMD</code> 加载依赖模块后会立即执行，并不考虑该该依赖模块后续是否会被使用</li> <li><code>AMD</code> 异步加载模块通过动态创建 script 标签实现，这会提高页面的 js 文件请求量</li> <li><code>AMD</code> 依赖前置的模式要求必须提前写好所需依赖，无法实现按需加载</li> <li><code>AMD</code> 规范使用起来稍显复杂，代码阅读和书写都比较困难</li></ul> <p>综上所述，<code>AMD</code> 规范只能说是前端模块化探索过程中的中间方案，距离现代模块化方案还相差甚远。</p> <h2 id="cmd-规范"><a href="#cmd-规范" class="header-anchor">#</a> CMD 规范</h2> <h3 id="基本使用-3"><a href="#基本使用-3" class="header-anchor">#</a> 基本使用</h3> <p><code>CMD</code>(<code>Common Module Definition</code>)规范是另一种异步模块化解决方案，它出现相对较晚，是在 <code>SeaJS</code> 推广过程中产生的，其吸收了 <code>AMD</code> 和 <code>Commonjs</code> 规范的一些优点。</p> <p><code>CMD</code> 规范规定：</p> <ul><li>一个文件就是一个模块</li> <li><code>define</code> 定义模块</li> <li><code>require</code> 方法加载模块</li></ul> <p><code>CMD</code> 规范使用起来非常简单，使用区别就在于 <code>factory</code> 的不同。</p> <ul><li>如果 <code>factory</code> 为对象或者字符串，直接就代表该模块的接口</li> <li>如果 <code>factory</code> 为函数，则表示模块的构造方法，执行该方法获取可以获取模块导出的接口。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">define</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当 <code>factory</code> 为函数时，其有三个参数: <code>require、exports、module</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// module content</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="核心要点-3"><a href="#核心要点-3" class="header-anchor">#</a> 核心要点</h3> <p>通过基础使用部分，可以发现 <code>CMD</code> 与 <code>AMD</code> 非常类似，下面的案例对比了两者的使用。但两者的设计思想有很大的差异，<code>AMD</code> 推崇<strong>依赖前置</strong>，而 <code>CMD</code> 则主张<strong>依赖就近，延迟执行</strong>。也就是说在 <code>CMD</code> 中，加载完依赖模块后不会立即执行，而是基于一种<strong>懒加载</strong>的思想，只有该模块后续被使用才会执行。</p> <p><code>CMD</code> 规范使用依赖就近的规则定义一个模块，会导致模块的加载逻辑偏重，此外对于当前模块的依赖关系也非常不直观。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// AMD</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;print&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">printModule</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  printModule<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;entry&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// CMD</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cosnt printModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./print'</span><span class="token punctuation">)</span>
  printModule<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;entry&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="esmodule-规范"><a href="#esmodule-规范" class="header-anchor">#</a> ESModule 规范</h2> <h3 id="基本使用-4"><a href="#基本使用-4" class="header-anchor">#</a> 基本使用</h3> <p>模块化方案关乎到整个前端生态链，官方在 <code>ECMAScript6</code> 标准中增加了 <code>JavaScript</code> 语言层面的模块体系定义，作为浏览器和服务器通用的模块解决方案，也就是 <code>ES6 Module</code>(或称为 <code>ESModule</code>、<code>ESM</code>)。</p> <p><code>ESModule</code> 规范并不复杂，使用起来相对也比较简单</p> <ul><li>一个模块就是一个独立的文件。该文件内部的所有变量，外部无法获取</li> <li><code>import</code> 命令用于输入其他模块提供的功能</li> <li><code>export</code> 命令用于规定模块的对外接口</li></ul> <h4 id="export"><a href="#export" class="header-anchor">#</a> export</h4> <p><code>export</code> 命令可以单个导出，也可以批量导出。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// zcxiaobao.js</span>
<span class="token comment">// 单个导出</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> firstName <span class="token operator">=</span> <span class="token string">&quot;zc&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> lastName <span class="token operator">=</span> <span class="token string">&quot;xiaobao&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> year <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>

<span class="token comment">// 批量导出</span>
<span class="token keyword">const</span> firstName <span class="token operator">=</span> <span class="token string">&quot;zc&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> lastName <span class="token operator">=</span> <span class="token string">&quot;xiaobao&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> year <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> firstName<span class="token punctuation">,</span> lastName<span class="token punctuation">,</span> year <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 导入</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> firstName<span class="token punctuation">,</span> lastName<span class="token punctuation">,</span> year <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./zcxiaobao.js&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>与 <code>Commonjs</code> 不同，<code>ESM</code> 导出的为值的引用，因此 <code>export</code> 命令在导出时<strong>需要为接口名和模块内部变量构建一一对应关系</strong>。</p> <p>例如下面的案例 <code>VSCode</code> 会提示错误。</p> <img src="/front-end-engineering-handbook/images/error-export.png" alt="error export"> <p><code>ESModule</code> 还支持默认导出的功能，即 <code>export default</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// export-default.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上述使用 <code>export default</code> 默认输出了一个函数。当然也可以默认导出非匿名函数，但在模块外部并没有任何作用，统统视为匿名函数。</p> <p>这时你可能会有疑惑？<code>export</code> 与 <code>export default</code> 的导出机制好像有些天差地别，如下面代码，<code>export default</code> 使用 <code>export</code> 格式导出会抛出错误。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// export-default.js</span>
<span class="token comment">// throw error</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">const</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>export default</code> 的本质是将后面的值赋值给 <code>default</code>，这是为什么那？别急，后面马上会讲，<code>import</code> 整体加载更直观，更容易理解。</p> <p>此外，<code>export default</code> 的定位是模块的默认导出，因此模块内只能使用一次。</p> <h4 id="import"><a href="#import" class="header-anchor">#</a> import</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// zcxiaobao.js</span>
<span class="token keyword">const</span> firstName <span class="token operator">=</span> <span class="token string">&quot;zc&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> lastName <span class="token operator">=</span> <span class="token string">&quot;xiaobao&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> year <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> firstName<span class="token punctuation">,</span> lastName<span class="token punctuation">,</span> year <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> male <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> male<span class="token punctuation">;</span>
</code></pre></div><p>我们以上面的代码介绍一下 <code>import</code> 的基本使用。</p> <p>对于 <code>export</code> 命令，<code>import</code> 命令接受一对大括号，里面指定要从其他模块导入的变量名。大括号里面的变量名，必须与被导入模块对外接口的名称相同。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// import-export.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> firstName<span class="token punctuation">,</span> lastName<span class="token punctuation">,</span> year <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./zcxiaobao.js&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>firstName<span class="token punctuation">,</span> lastName<span class="token punctuation">,</span> year<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>由于 <code>ESModule</code> 在编译时运行，因此大括号内不支持运行时才能得到结果表达式和变量。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// import-error.js</span>
<span class="token comment">// throw error</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token string">'first'</span> <span class="token operator">+</span> <span class="token string">'Name'</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./zcxiaobao.js&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>对于 <code>export default</code> 命令，<code>import</code> 导入时可以任意为其重新命名，但切记此时不需要大括号。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// import-default.js</span>
<span class="token keyword">import</span> zcMale <span class="token keyword">from</span> <span class="token string">&quot;./zcxiaobao.js&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Male<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// 也可以混合导入</span>
<span class="token keyword">import</span> zcMale<span class="token punctuation">,</span> <span class="token punctuation">{</span> firstName<span class="token punctuation">,</span> lastName <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./zcxiaobao.js&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>zcMale<span class="token punctuation">,</span> firstName<span class="token punctuation">,</span> lastName<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>除了指定加载某些值，<code>import</code> 还支持整体加载。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// import-whole.js</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> zcxiaobao <span class="token keyword">from</span> <span class="token string">&quot;./zcxiaobao.js&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>zcxiaobao<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><img src="/front-end-engineering-handbook/images/import-whole.png" alt="import whole"> <p>我们惊喜的发现，<code>default</code> 也出现了，同时与 <code>firstName</code> 等属性是平级的。</p> <p>上文提过 <code>export</code> 命令的本质是在导出时<strong>需要为接口名和模块内部变量构建一一对应关系</strong>，那是不是意味着 <code>default</code> 是 <code>ESModule</code> 内置构建的默认接口，缺少的只不过是与内部变量的对应关系。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// zcxiaobao2.js</span>
<span class="token keyword">const</span> firstName <span class="token operator">=</span> <span class="token string">&quot;zc&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> male <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> firstName<span class="token punctuation">,</span> male <span class="token keyword">as</span> <span class="token keyword">default</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// try</span>
<span class="token keyword">import</span> zcMale<span class="token punctuation">,</span> <span class="token punctuation">{</span> firstName <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./zcxiaobao2.js&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>zcMale<span class="token punctuation">,</span> firstName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true,zc</span>
</code></pre></div><p>也就是说 <code>export default</code> 可以理解为<strong>export 一个特殊的语法糖，本质就是输出 default 的变量或方法</strong>，只不过系统允许随便为它命名。</p> <p>掌握了 <code>export default</code> 的本质，对于下面的使用错误应该可以轻松找到问题所在。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// zcxiaobao3.js</span>
<span class="token keyword">const</span> firstName <span class="token operator">=</span> <span class="token string">&quot;zc&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> male <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> firstName<span class="token punctuation">,</span> male <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> firstName<span class="token punctuation">,</span> male <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./zcxiaobao3.js&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="esmodule-的发展"><a href="#esmodule-的发展" class="header-anchor">#</a> ESModule 的发展</h2> <h3 id="import-2"><a href="#import-2" class="header-anchor">#</a> import()</h3> <p><code>ESModule</code> 在编译时运行，编译时会对 <code>import</code> 命令进行静态分析，这也就意味着 <code>import</code> 和 <code>export</code> 命令只能在模块的顶层，不能在代码块之中。例如下面的代码就会报错</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> firstName <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./zcxiaobao.js&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>得益于编译时运行机制，可以实现模块的静态分析，可以实现类似 <code>TreeShaking</code> 等功能减少不必要的代码，但这同样也丧失了运行时模块加载的功能。</p> <p><code>Commonjs</code> 为运行时加载，<code>require</code> 函数可以出现在任何地方，模块的动态加载自由。</p> <p>ES2020 中，<strong>引入了 import() 函数，来实现动态加载模块</strong>，该方法返回一个 <code>Promise</code> 对象，可以支持按需加载，大大提高了模块引用的灵活性。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// dynamic-import.js</span>
<span class="token keyword">function</span> <span class="token function">getZc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./zcxiaobao.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> firstName<span class="token punctuation">,</span> lastName <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>firstName <span class="token operator">+</span> lastName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">getZc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// zcxiaobao</span>
</code></pre></div><p>(import())[https://caniuse.com/?search=import()]函数的可以兼容市面 95% 以上的浏览器份额，可以比较放心的应用于日常开发中。</p> <img src="/front-end-engineering-handbook/images/dynamic-import.png" alt="dynamic-import"> <h3 id="import-meta"><a href="#import-meta" class="header-anchor">#</a> import.meta</h3> <p>开发者开发模块时，有时需要获取模块自身的信息，类似于 <code>Commonjs</code> 为模块注入的 <code>__filename</code>，<code>__dirname</code> 变量等。</p> <p>ES2020 提案中，为 <code>import</code> 命令添加了一个元属性 <code>import.meta</code>，返回当前模块的元信息。<code>import.meta.url</code> 返回当前模块的 URL 路径。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// import-meta.js</span>
<span class="token comment">// Nodejs 环境下执行，返回本地路径。</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// file:URL</span>
</code></pre></div><p>从 <code>caniuse</code> 可以查到，<a href="https://caniuse.com/?search=import.meta" target="_blank" rel="noopener noreferrer">import.meta<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>元属性也达到 95%以上的兼容性。</p> <img src="/front-end-engineering-handbook/images/import-meta.png" alt="import-meta"> <h2 id="commonjs-与-esm-对比"><a href="#commonjs-与-esm-对比" class="header-anchor">#</a> Commonjs 与 ESM 对比</h2> <h3 id="拷贝-vs-引用"><a href="#拷贝-vs-引用" class="header-anchor">#</a> 拷贝 vs 引用</h3> <p>上文讲到<strong>Commonjs 模块输出的是值的拷贝，对于原始类型，复制其值，模块内部的变化不会影响导出值；对于引用类型为浅复制，属性的变动会影响导出值</strong>。</p> <p><code>ESModule</code> 运行机制与 <code>Commonjs</code> 不同。ESM 导入模块是在编译阶段进行静态分析确定模块的依赖关系，并将 import 导入语句提升到模块首部，生成只读引用，链接到引入模块的 export 接口，等到脚本真正执行时，再根据这个只读引用，到被加载的那个模块里面去取值。也就是说如果模块内代码运行过程中原始值发生变化，import 加载值也会发生改变。</p> <p>下面借助案例来看一下两者的区别。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// moduleA.js</span>
<span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  count<span class="token operator">++</span><span class="token punctuation">;</span>
  obj<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">alterObj</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">newCount</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> add<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> alterObj <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// entry.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> add<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> alterObj <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./moduleA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;count: &quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">,</span> <span class="token string">&quot; obj.count:&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// count:  0  obj.count: 0</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;count: &quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">,</span> <span class="token string">&quot; obj.count:&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// count:  0  obj.count: 1</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;obj&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// obj { count: 1 }</span>
<span class="token function">alterObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;obj&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// obj { count: 1 }</span>
</code></pre></div><ul><li>ESModule 部分</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// moduleA.js</span>
<span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  count<span class="token operator">++</span><span class="token punctuation">;</span>
  obj<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">alterObj</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">newCount</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> add<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> alterObj <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// entry.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> add<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> alterObj <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./moduleA.js&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;count: &quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">,</span> <span class="token string">&quot; obj.count:&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// count:  0  obj.count: 0</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;count: &quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">,</span> <span class="token string">&quot; obj.count:&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// count:  1  obj.count: 1</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;obj&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// obj { count: 1 }</span>
<span class="token function">alterObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;obj&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// obj { newCount: 0 }</span>
</code></pre></div><p>总之，<code>ESModule</code> 是动态引用，并且不会缓存值，模块里面的变量绑定其所在的模块。</p> <h3 id="运行-vs-编译"><a href="#运行-vs-编译" class="header-anchor">#</a> 运行 vs 编译</h3> <p><code>Commonjs</code> 模块的本质是一个对象，模块加载的过程即 <code>module.exports</code> 对象的生成过程，然后 <code>require</code> 方法再从对象上读取方法，这种加载被称为运行时加载。最大特性是<strong>全部加载</strong>，只有运行时才能得到该对象，无法在编译时做静态优化</p> <p><code>ESModule</code> 则是通过静态分析 <code>import</code> 命令来构建起 <code>import</code> 与 <code>export</code> 导出的只读引用(该引用不可修改)，后续脚本执行后再沿只读引用获取值。最大特性是<strong>按需加载</strong>，在编译时就完成模块加载。</p> <p>这也就客观解释了为什么 <code>require</code> 可以出现在任何地方，而 <code>import</code> 必须在模块顶层。</p> <blockquote><p>为了能更好的取代 require 函数，ES2020 引入了 import() 函数，支持动态加载模块，import() 函数同样也可以出现在任何地方。</p></blockquote> <h3 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h3> <ul><li>同步 vs 异步: <code>Commonjs</code> 模块读取使用 Node.js 的 fs.readSync 方法，为同步加载模式，通常应用于服务端；<code>ESModule</code> 则通过 CORS 的方式请求外部 js 模块，为异步加载模式，目前可用于服务端及浏览器端。</li> <li>严格模式: <code>Commonjs</code> 默认是非严格模式，而 <code>ESModule</code> 默认是严格模式。</li></ul> <h2 id="模块化未来探讨"><a href="#模块化未来探讨" class="header-anchor">#</a> 模块化未来探讨</h2> <p><code>Commonjs</code> 同步模块加载模式仅适用于服务端，<code>AMD</code>、<code>CMD</code> 异步加载模式，仅适用于浏览器端。<code>AMD</code> 依赖前置可以比较直观的发现依赖关系，但不支持按需加载，<code>CMD</code> 依赖就近模块间的依赖就非常不直观。</p> <p>可见，这三种模块化方案都存在自身的局限性，距离模块化终极解决方案还有一段距离。</p> <p>关于 ESM，官方文档中是这样描述的: &quot;The goal for ECMAScript 6 modules was to create a format that both users of Commonjs and of AMD are happy with&quot;(ECMAScript 6 modules 的目标是创造一个让 Commonjs 和 AMD 用户都满意的格式)</p> <p>不难发现 JavaScript 官方对于 <code>ESModule</code> 的初衷便是为了实现前端模块化标准的大统一。</p> <p>要实现这一点并不容易，咱们来看一下 <code>ESModule</code> 为何有底气实现模块化标准的大一统？</p> <h3 id="服务端与浏览器端"><a href="#服务端与浏览器端" class="header-anchor">#</a> 服务端与浏览器端</h3> <p>Nodejs 12.20 版本开始，提供了对 <code>ESModule</code> 的原生支持，也就是说对于高版本 Nodejs，<code>ESModule</code> 规范已经初步实现了服务端与浏览器端的一统。</p> <p>ES2020 提案中提出 <code>import()</code> 函数，支持模块的动态加载。</p> <p><code>ESModule</code> 在某种程度上已经实现了对 <code>Commonjs</code> 的覆盖，额外还附带编译时加载，可静态分析依赖关系等特性。</p> <h3 id="兼容性"><a href="#兼容性" class="header-anchor">#</a> 兼容性</h3> <p><code>ESModule</code> 由官方提出，通过 <a href="https://caniuse.com/?search=%3Cscript%20type%3D%22module%22%3E" target="_blank" rel="noopener noreferrer">caniuse<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 查询可以发现，<code>ESModule</code> 已经可以适配 95% 以上的现代浏览器，兼容性经得住考验。</p> <img src="/front-end-engineering-handbook/images/esm-caniuse.png" alt="esm-caniuse"> <h3 id="pure-esm"><a href="#pure-esm" class="header-anchor">#</a> Pure ESM</h3> <p>随着 <code>ESMoudle</code> 的推进，社区里面很多 npm 包逐渐开始 <code>ESModule First</code> 趋势，越来越多的包也开始提供 <code>ESMoule</code> 版本，甚至一些包更加激进，推崇 <code>Pure ESM</code> 格式，例如著名的 chalk。</p> <blockquote><p>chalk 自从 5.0 以后，只提供 ESM 格式产物</p></blockquote> <p><code>Pure ESM</code> 意思很明显，即抛弃 <code>Commonjs</code> 等格式产物，只保留 <code>ESMoule</code> 产物。</p> <p>那么关于 <code>Pure ESM</code>，目前我们应该持有何种态度那？</p> <p>小包阅读了一些<a href="https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c" target="_blank" rel="noopener noreferrer">PureESM 原贴<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://antfu.me/posts/publish-esm-and-cjs" target="_blank" rel="noopener noreferrer">antfu 大佬 blog<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>及<a href="https://juejin.cn/book/7050063811973218341/section/7068105121615314952?enter_from=course_center" target="_blank" rel="noopener noreferrer">神三元大佬小册<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的理解，大致可以总结出两点:</p> <ul><li>对于大型框架，例如 Nuxt、Vite 等，能拥抱 Pure ESM，建议直接使用，推动社区向 ESM 迁移</li> <li>对于底层基础库，不推荐使用 Pure ESM，推荐产出 <code>ESModule</code>、<code>Commonjs</code> 两种产物</li></ul> <p>Pure ESM 并不是这篇文章的核心内容，此外 Pure ESM 是一个比较有前沿价值、有讨论意义的话题，后续会单独一篇文章进行讨论。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>通过上面的分析，我们可以发现 <code>ESModule</code> 具备更简单的导入导出、支持编译时静态分析、<code>tree-shaking</code> 及浏览器端及服务器端的原生支持，可以说，到目前为止，它已经囊括了现代模块化规范的所有优势。</p> <p>Pure ESM 的浪潮一波接一波，越来越多的包开始支持 ESM 格式，这都不断推动了前端整体生态开始迈向 ESM 时代。</p> <p>更重要的是，为 <code>ESM</code> 背书的可是官方大大，官方大大对 ESM 有着野心也有着信心，最近的提案中，不断有新特性被提出，例如 import.meta、import.map 等。</p> <p>我们完全可以大胆的说，<code>ESMoudle</code> 就是前端模块化的未来。</p> <img src="/front-end-engineering-handbook/images/module-all-summary.png" alt="模块化规范总结"> <h2 id="后语"><a href="#后语" class="header-anchor">#</a> 后语</h2> <p>我是  <strong>战场小包</strong> ，一个快速成长中的小前端，希望可以和大家一起进步。</p> <p>如果喜欢小包，可以在  <strong><a href="https://github.com/zcxiaobao" target="_blank" rel="noopener noreferrer">github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong>  关注我，同样也可以关注我的小小公众号——<strong><a href="https://zcxiaobao.gitee.io/wx-demo/wx.png" target="_blank" rel="noopener noreferrer">小包学前端<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong>。</p> <p>一路加油，冲向未来!!!</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/front-end-engineering-handbook/module/origin.html" class="prev">
          模块化前世今生
        </a></span> <span class="next"><a href="/front-end-engineering-handbook/module/pure-esm.html">
          Pure ESM &amp; Dual Packages
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-3b069fde data-v-349e681a><li class="level-2" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#写在前面" class="sidebar-link reco-side-写在前面" data-v-3b069fde>写在前面</a></li><li class="level-2" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#commonjs-规范" class="sidebar-link reco-side-commonjs-规范" data-v-3b069fde>Commonjs 规范</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#基本使用" class="sidebar-link reco-side-基本使用" data-v-3b069fde>基本使用</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#核心要点" class="sidebar-link reco-side-核心要点" data-v-3b069fde>核心要点</a></li><li class="level-2" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#amd-规范" class="sidebar-link reco-side-amd-规范" data-v-3b069fde>AMD 规范</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#基本使用-2" class="sidebar-link reco-side-基本使用-2" data-v-3b069fde>基本使用</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#核心要点-2" class="sidebar-link reco-side-核心要点-2" data-v-3b069fde>核心要点</a></li><li class="level-2" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#cmd-规范" class="sidebar-link reco-side-cmd-规范" data-v-3b069fde>CMD 规范</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#基本使用-3" class="sidebar-link reco-side-基本使用-3" data-v-3b069fde>基本使用</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#核心要点-3" class="sidebar-link reco-side-核心要点-3" data-v-3b069fde>核心要点</a></li><li class="level-2" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#esmodule-规范" class="sidebar-link reco-side-esmodule-规范" data-v-3b069fde>ESModule 规范</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#基本使用-4" class="sidebar-link reco-side-基本使用-4" data-v-3b069fde>基本使用</a></li><li class="level-2" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#esmodule-的发展" class="sidebar-link reco-side-esmodule-的发展" data-v-3b069fde>ESModule 的发展</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#import-2" class="sidebar-link reco-side-import-2" data-v-3b069fde>import()</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#import-meta" class="sidebar-link reco-side-import-meta" data-v-3b069fde>import.meta</a></li><li class="level-2" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#commonjs-与-esm-对比" class="sidebar-link reco-side-commonjs-与-esm-对比" data-v-3b069fde>Commonjs 与 ESM 对比</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#拷贝-vs-引用" class="sidebar-link reco-side-拷贝-vs-引用" data-v-3b069fde>拷贝 vs 引用</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#运行-vs-编译" class="sidebar-link reco-side-运行-vs-编译" data-v-3b069fde>运行 vs 编译</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#其他" class="sidebar-link reco-side-其他" data-v-3b069fde>其他</a></li><li class="level-2" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#模块化未来探讨" class="sidebar-link reco-side-模块化未来探讨" data-v-3b069fde>模块化未来探讨</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#服务端与浏览器端" class="sidebar-link reco-side-服务端与浏览器端" data-v-3b069fde>服务端与浏览器端</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#兼容性" class="sidebar-link reco-side-兼容性" data-v-3b069fde>兼容性</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#pure-esm" class="sidebar-link reco-side-pure-esm" data-v-3b069fde>Pure ESM</a></li><li class="level-2" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#总结" class="sidebar-link reco-side-总结" data-v-3b069fde>总结</a></li><li class="level-2" data-v-3b069fde><a href="/front-end-engineering-handbook/module/esm.html#后语" class="sidebar-link reco-side-后语" data-v-3b069fde>后语</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-2a01419c data-v-2a01419c><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-2a01419c><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-2a01419c></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-2a01419c></path></svg></div></div></div>
    <script src="/front-end-engineering-handbook/assets/js/app.a64d5fad.js" defer></script><script src="/front-end-engineering-handbook/assets/js/3.e17cbad9.js" defer></script><script src="/front-end-engineering-handbook/assets/js/1.45b034b9.js" defer></script><script src="/front-end-engineering-handbook/assets/js/14.e80d8315.js" defer></script>
  </body>
</html>
