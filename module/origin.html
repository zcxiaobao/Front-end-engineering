<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>剥茧抽丝，细数模块化的前世今生 | 前端工程化打怪升级手册</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="开局一条狗，如何征服工程化">
    
    <link rel="preload" href="/front-end-engineering-handbook/assets/css/0.styles.4d68ed8c.css" as="style"><link rel="preload" href="/front-end-engineering-handbook/assets/js/app.a64d5fad.js" as="script"><link rel="preload" href="/front-end-engineering-handbook/assets/js/3.e17cbad9.js" as="script"><link rel="preload" href="/front-end-engineering-handbook/assets/js/1.45b034b9.js" as="script"><link rel="preload" href="/front-end-engineering-handbook/assets/js/15.1a4bb958.js" as="script"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/10.1c36d85b.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/11.59096481.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/12.2f6247a0.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/13.5b88f3c4.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/14.e80d8315.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/16.2af617f6.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/4.396f0bf8.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/5.497640ae.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/6.735b6bed.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/7.3e29ab9c.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/8.adbd1ce3.js"><link rel="prefetch" href="/front-end-engineering-handbook/assets/js/9.a792d7fc.js">
    <link rel="stylesheet" href="/front-end-engineering-handbook/assets/css/0.styles.4d68ed8c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-349e681a><div data-v-349e681a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-b3e6ef50 data-v-349e681a data-v-349e681a><h3 class="title" data-v-b3e6ef50>前端工程化打怪升级手册</h3> <p class="description" data-v-b3e6ef50>开局一条狗，如何征服工程化</p> <label id="box" class="inputBox" data-v-b3e6ef50><input type="password" value="" data-v-b3e6ef50> <span data-v-b3e6ef50>Konck! Knock!</span> <button data-v-b3e6ef50>OK</button></label> <div class="footer" data-v-b3e6ef50><span data-v-b3e6ef50><i class="iconfont reco-theme" data-v-b3e6ef50></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-b3e6ef50>vuePress-theme-reco</a></span> <span data-v-b3e6ef50><i class="iconfont reco-copyright" data-v-b3e6ef50></i> <a data-v-b3e6ef50><!---->
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-349e681a><header class="navbar" data-v-349e681a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/front-end-engineering-handbook/" class="home-link router-link-active"><!----> <span class="site-name">前端工程化打怪升级手册</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/front-end-engineering-handbook/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      战场小包
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zcxiaobao" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/4424090519078430" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-349e681a></div> <aside class="sidebar" data-v-349e681a><div class="personal-info-wrapper" data-v-1bfe3fa5 data-v-349e681a><!----> <!----> <div class="num" data-v-1bfe3fa5><div data-v-1bfe3fa5><h3 data-v-1bfe3fa5>7</h3> <h6 data-v-1bfe3fa5>文章</h6></div> <div data-v-1bfe3fa5><h3 data-v-1bfe3fa5>0</h3> <h6 data-v-1bfe3fa5>标签</h6></div></div> <ul class="social-links" data-v-1bfe3fa5></ul> <hr data-v-1bfe3fa5></div> <nav class="nav-links"><div class="nav-item"><a href="/front-end-engineering-handbook/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      战场小包
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/zcxiaobao" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/4424090519078430" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/front-end-engineering-handbook/module/origin" class="sidebar-heading clickable open active"><span>基础部分</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/front-end-engineering-handbook/module/origin.html" aria-current="page" class="active sidebar-link">模块化前世今生</a></li><li><a href="/front-end-engineering-handbook/module/esm.html" class="sidebar-link">前端模块化未来探索</a></li><li><a href="/front-end-engineering-handbook/module/pure-esm.html" class="sidebar-link">Pure ESM &amp; Dual Packages</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-b3e6ef50 data-v-349e681a><h3 class="title" data-v-b3e6ef50>剥茧抽丝，细数模块化的前世今生</h3> <!----> <label id="box" class="inputBox" data-v-b3e6ef50><input type="password" value="" data-v-b3e6ef50> <span data-v-b3e6ef50>Konck! Knock!</span> <button data-v-b3e6ef50>OK</button></label> <div class="footer" data-v-b3e6ef50><span data-v-b3e6ef50><i class="iconfont reco-theme" data-v-b3e6ef50></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-b3e6ef50>vuePress-theme-reco</a></span> <span data-v-b3e6ef50><i class="iconfont reco-copyright" data-v-b3e6ef50></i> <a data-v-b3e6ef50><!---->
          
        <!---->
        2023
      </a></span></div></div> <div data-v-349e681a><div data-v-349e681a><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">剥茧抽丝，细数模块化的前世今生</h1> <div data-v-0b291498><i class="iconfont reco-account" data-v-0b291498><span data-v-0b291498>战场小包</span></i> <i class="iconfont reco-date" data-v-0b291498><span data-v-0b291498>2021/3/16</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h2 id="写在前面"><a href="#写在前面" class="header-anchor">#</a> 写在前面</h2> <blockquote><p>本篇是前端工程化打怪升级的第 1 篇， <a href="https://zcxiaobao.github.io/front-end-engineering-handbook/module/esm.html" target="_blank" rel="noopener noreferrer"><strong>小册传送门</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> | <a href="https://github.com/zcxiaobao/front-end-engineering-handbook/tree/main/code/1.no-module" target="_blank" rel="noopener noreferrer"><strong>案例代码</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>近几年，时常会感叹，前端，发展的太迅猛了。日新月异的新概念，异彩纷呈的新思想泉水般涌出；前端项目的复杂度、开发成本、维护难度也在不断提升，前端三件套开发模式(HTML-CSS-JS)滞后于前端的进步，这要求我们需要以更高层次的眼光来重新审视前端——工程化。工程化是一个工学概念，其核心是结合实际建立科学的、规范的设计和生产流程，目的是<strong>降本提效</strong>。</p> <p>前端工程化目前还没有比较完善的定义，各种论调众说纷纭，很多朋友很容易把工程化与 webpack 画等号，这其实一种不完善的理解，以我看来<strong>其是指借助科学的软件工程方法，更科学、严谨、系统的管理和维护整个前端开发的全流程</strong>。又或者理解为比较主流的工程四化：<strong>模块化、组件化、规范化、自动化</strong>。</p> <p>模块化是前端工程化的核心要素，重中之重，理解模块化是掌握工程化的重要一步。因此本文以早期模块化演变进程为着眼点，带你理解</p> <ul><li>什么是模块化</li> <li>为什么需要模块化</li> <li>早期模块化的演变进程</li> <li>应用于模块化的依赖注入</li></ul> <h2 id="模块化"><a href="#模块化" class="header-anchor">#</a> 模块化</h2> <p>维基百科的定义还是有几分难以理解，咱们用前端的话术修饰一下，模块化其实就是指解决一个复杂问题时<strong>自顶向下逐层把系统划分成若干模块</strong>的过程，每个模块完成一个特定的子功能（单一职责），<strong>模块内部私有，对外暴露接口与其他模块通信</strong>，所有的模块按某种方法组装起来，成为一个整体，从而完成整个系统所要求的功能。</p> <p>还是有些难以理解，举一个现实中的栗子，火箭系统就是比较典型的模块化设计，一般会有三大模块：控制、动力、结构。三个模块各司其职；同时也存在部分的依赖关系，例如控制是核心模块，需要操纵结构模块与动力模块。</p> <img src="/front-end-engineering-handbook/images/rocket-module.png" alt="火箭的模块化"> <p>那么模块化有什么好处那？从火箭案例可以发现，各自模块都拥有自身的核心业务，擅长结构的从事结构模块研究，精研控制的设计控制程序，各司其职，模块化设计是一种降本提效的好方案。在前端中亦是如此，具体的好处小包暂且不多言，下面一起来经历模块化的演变过程，在此之后，你会有更深刻的理解。</p> <h2 id="文件划分"><a href="#文件划分" class="header-anchor">#</a> 文件划分</h2> <p>在早期刀耕火种的前端三件套时代，HTML 中通过引入到多个不同逻辑的 js 文件，构成了最原始的模块化实现方式——文件划分模式。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// moduleA.js</span>
<span class="token keyword">let</span> moduleName <span class="token operator">=</span> <span class="token string">&quot;moduleA&quot;</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// moduleB.js</span>
<span class="token keyword">let</span> <span class="token function-variable function">getModuleName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;This is moduleB!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// entry.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// moduleA</span>
<span class="token function">getModuleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// This is moduleB!</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./moduleA.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./moduleB.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./entry.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>上述案例代码中，entry.js 分别使用了 <code>moduleA</code>、<code>moduleB</code> 的变量与函数，实现了简易的代码分离与组织，但随着代码量的增大及项目复杂度的增加，文件划分方式存在很多问题。</p> <ul><li><strong>命名冲突</strong>: <code>moduleA</code> 和 <code>moduleB</code> 定义在全局，并没有构造私有空间，如果 <code>moduleB</code> 同时定义了 <code>moduleName</code>，两个模块间就会发生变量名的覆盖，引起变量冲突</li> <li><strong>依赖模糊</strong>: 无法清晰的确定模块之间的依赖关系和加载顺序。文件划分方式中被依赖项需要引用在前，也就是说 script 引入顺序仅仅提供了某些 js 文件的前后依赖，并不能确切的反应各模块间的依赖关系。</li> <li><strong>维护性差</strong>: 代码间组织方式混乱，后期维护难度较高</li> <li><strong>复用性差</strong></li></ul> <p>文件划分模式的缺点简直可以举一大箩筐，后续模块化的演变正是对缺点的不断优化。</p> <h2 id="命名空间"><a href="#命名空间" class="header-anchor">#</a> 命名空间</h2> <p>命名空间是另一种模块化的实现方案，其目的在于解决<strong>命名冲突</strong>问题。</p> <p>命名空间的核心实现在于将变量与函数声明为对象的属性，只要外层对象命名不发生冲突，内部的成员就不会发生覆盖。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// moduleA.js</span>
<span class="token keyword">let</span> moduleA <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">moduleName</span><span class="token operator">:</span> <span class="token string">&quot;moduleA&quot;</span><span class="token punctuation">,</span>
  <span class="token function">getModuleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>moduleName<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// moduleB.js</span>
<span class="token keyword">let</span> moduleB <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">moduleName</span><span class="token operator">:</span> <span class="token string">&quot;moduleB&quot;</span><span class="token punctuation">,</span>
  <span class="token function">getModuleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>moduleName<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// entry.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moduleA<span class="token punctuation">.</span><span class="token function">getModuleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// moduleA</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moduleB<span class="token punctuation">.</span><span class="token function">getModuleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// moduleB</span>
</code></pre></div><p>命名空间的写法一定程度上减少了命名冲突问题，但其本质写法为对象，并没有构建私有作用域，所有模块的成员可以被外部访问，这违背了模块化的设计理念，同时也无法管理模块间的依赖问题。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// entry.js</span>
moduleA<span class="token punctuation">.</span>moduleName <span class="token operator">=</span> <span class="token string">&quot;alterModule&quot;</span><span class="token punctuation">;</span>
moduleA<span class="token punctuation">.</span><span class="token function">getModuleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// alterModule</span>
</code></pre></div><h2 id="iife"><a href="#iife" class="header-anchor">#</a> IIFE</h2> <p>JavaScript 中函数可以生成函数作用域，外部无法访问内部定义的成员，<strong>使用闭包思想，可以将内部成员暴露给外部使用</strong>。因此可以借助<strong>函数+闭包</strong>特性实现私有数据和共享方法，由于该函数只是为了辅助模块化的实现，因此采用 <code>IIFE</code> 立即执行函数的模式。</p> <p>当外部使用 <code>IIFE</code> 构建的模块时，只能通过模块提供的接口进行操作，无法访问私有成员。这种方式成功的解决了命名冲突以及私有空间的问题，同时也是现代模块化规范的思想来源。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// moduleA.js</span>
<span class="token keyword">let</span> moduleA <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> _moduleName <span class="token operator">=</span> <span class="token string">&quot;moduleA&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">getModuleName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> _moduleName<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> getModuleName <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// moduleB.js</span>
<span class="token keyword">let</span> moduleB <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> _moduleName <span class="token operator">=</span> <span class="token string">&quot;moduleB&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">getModuleName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> _moduleName<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> getModuleName <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// entry.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moduleA<span class="token punctuation">.</span><span class="token function">getModuleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// moduleA</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moduleB<span class="token punctuation">.</span><span class="token function">getModuleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// moduleB</span>

moduleA<span class="token punctuation">.</span>_moduleName <span class="token operator">=</span> <span class="token string">&quot;alterModule&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moduleA<span class="token punctuation">.</span><span class="token function">getModuleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// moduleA</span>
</code></pre></div><p>新的问题来了，<code>IIFE</code> 方式可以解决依赖问题吗？</p> <p>这时可以使用引入依赖，即通过 <strong>IIFE 的函数参数</strong>将依赖传入。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// moduleC.js</span>
<span class="token keyword">let</span> moduleC <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> _moduleName <span class="token operator">=</span> <span class="token string">&quot;moduleC&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> _moduleData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">getModuleData</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Module: &quot;</span><span class="token punctuation">,</span> _moduleName<span class="token punctuation">,</span> <span class="token string">&quot; Data: &quot;</span><span class="token punctuation">,</span> _moduleData<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> getModuleData <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// moduleA.js</span>
<span class="token keyword">let</span> moduleA <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> _moduleName <span class="token operator">=</span> <span class="token string">&quot;moduleA&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">getModuleName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_moduleName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span><span class="token function">getModuleData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> getModuleName <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>moduleC<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// entry.js</span>

<span class="token comment">// Module:  moduleC  Data: 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moduleA<span class="token punctuation">.</span><span class="token function">getModuleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// moduleA</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moduleB<span class="token punctuation">.</span><span class="token function">getModuleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// moduleB</span>
</code></pre></div><p><code>IIFE</code> 方式大家其实都不陌生，jQuery 时期有很多类似的实现，例如 jQuery 源码如何将 $ 挂载到 window 实例上(换个角度可以理解为依赖了 jquery 模块)。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">global<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
  <span class="token function">factory</span><span class="token punctuation">(</span>global<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span> <span class="token operator">?</span> window <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">window<span class="token punctuation">,</span> noGlobal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  window<span class="token punctuation">.</span>jQuery <span class="token operator">=</span> window<span class="token punctuation">.</span>$ <span class="token operator">=</span> jQuery<span class="token punctuation">;</span>
  <span class="token keyword">return</span> jQuery<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// function jQuery(){}</span>
</code></pre></div><h2 id="依赖注入"><a href="#依赖注入" class="header-anchor">#</a> 依赖注入</h2> <p>在 <code>IIFE</code> 方式之后，后续又出现了多种模块化方案，例如模板定义依赖、注册定义依赖、Sandbox 模式、依赖注入。</p> <p>依赖注入的作为重要的开发思想，解耦大杀器，目前已经遍布前端世界，vue3、react、angular、nest 等都有使用，因此本文来特地讲解一下。</p> <p>先来看看相关的几个重要概念:</p> <h3 id="依赖倒置原则"><a href="#依赖倒置原则" class="header-anchor">#</a> 依赖倒置原则</h3> <p>依赖倒置原则(Dependence Inversion Principle，DIP): 高层模块不应该依赖底层模块，两者都应该依赖其抽象，抽象不能够依赖于具体 ，具体必须依赖于抽象。</p> <img src="/front-end-engineering-handbook/images/micro-module-inject.png" alt="微波炉"> <p>举个栗子，假设我们是一家微波炉生产商，我们有着成熟的上下游生产链，例如我们与微波炉核心模块供应商建立了合作关系。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> MicroCoreS <span class="token keyword">from</span> <span class="token string">&quot;vendor&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Microwave</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">brand</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>core <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MicroCoreS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>brand <span class="token operator">=</span> <span class="token string">&quot;zcxiaobao&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在我们创业初期，上述的实现完全可以满足我们的需求，但随着时代的发展，<code>codeS</code> 类型核心开始难以满足最新市场，因此核心模块供应商推出了 <code>codeL</code> 类型核心。</p> <p>这时我们就可以发现，我们的基类 <code>Microwave</code> 被 <code>coreS</code> 锁住了，如果想要升级为 <code>coreL</code>，需要全部替换或者重新创建 <code>MicrowaveL</code> 基类，<strong>牵一发而动全身</strong>，低效高成本。</p> <p>DIP 就是为了解决这个问题而提出的，我们重新回顾一下 DIP 的定义:</p> <blockquote><p>高层模块不应该依赖底层模块，两者都应该依赖其抽象，抽象不能够依赖于具体，具体必须依赖于抽象</p></blockquote> <p>因此在这里我们不再直接紧耦合于 <code>core</code> 的具体设计，而是引入基于 <code>core</code> 的抽象设计(接口)，通俗来讲即<strong>微波炉核心的设计标准</strong>。</p> <img src="/front-end-engineering-handbook/images/micro-module-inject-dip.png" alt="微波炉2"> <p>接下来不论供应商如何迭代升级，我们只需按照 <code>MicroCore</code> 的标准实现新核心即可。</p> <p>从上面两张图可以清楚的看到，前者 <code>Microwave</code> 与 <code>coreS</code> 和 <code>coreL</code> 是紧耦合关系；后者 <code>Microwave、coreL、coreS</code> 共同依赖于抽象接口 <code>MicroCore</code>，实现了松耦合。</p> <p>总结来说: <strong>假设有两个类 classA 和 classB，如果 classA 依赖 classB，这便是紧耦合；如果 classA 依赖 interfaceB，而 classB 实现了 interfaceB，这便是依赖倒置。</strong></p> <h3 id="控制反转"><a href="#控制反转" class="header-anchor">#</a> 控制反转</h3> <p>控制反转(Inversion of Control，IOC)是面向对象编程中的一种设计原则，它通过反转调用方和被调用方之间的关系，实现解耦合。</p> <h3 id="依赖注入-2"><a href="#依赖注入-2" class="header-anchor">#</a> 依赖注入</h3> <p>依赖注入(Dependency Injection，DI)是 IOC 最常见的方式，通过<strong>将被依赖对象的创建和管理由依赖方转移到外部容器(或者框架)，然后将依赖的对象注入到需要使用的地方</strong>，实现解耦合。</p> <p>微波炉的生产过程中，会需要多类组件，例如核心、外壳，各类组件也会依赖于其他组件，例如核心模块还会依赖于电导丝，电导丝还会有多种类型材料。诸如此类的生产关系，就会共同构建成一个复杂的依赖网络(Dependency Network)。</p> <img src="/front-end-engineering-handbook/images/micro-module.png" alt="微波炉3"> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> microwave <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Microwave</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">coreL</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ElectricConductor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">coreMaterial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>看完例子后，我们重新品味一下依赖注入的定义，可以得出两大核心点: <strong>存储被依赖对象的外部容器，将依赖注入所需地方</strong>。</p> <p>微波炉的生产过程类似于依赖注入过程，其全部模块就构成<strong>存储被依赖对象的外部容器</strong>。然后不同类型的微波炉使用不同的模块进行组装，例如电导丝 A 型与电导丝 B 型微波炉注入不同的电导丝模块。</p> <h3 id="实现"><a href="#实现" class="header-anchor">#</a> 实现</h3> <p>依赖注入是面向对象中常用的编程思想，因此上文主要以类和接口为切入点，更方便理解，那模块化中的依赖注入又是怎样的那？</p> <img src="/front-end-engineering-handbook/images/module_inject_case.png" alt="微波炉3"> <p>从图中案例我们可以清晰的理清模块化中的依赖注入。</p> <ul><li>开发静态网站：注入前端传统三件套即可</li> <li>开发复杂网站: 依赖池全部注入，开发难度尚高，因此可以注册新的 vue 依赖</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 具象化三大模块</span>
<span class="token keyword">function</span> <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ability</span><span class="token operator">:</span> <span class="token string">&quot;code module&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">vite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ability</span><span class="token operator">:</span> <span class="token string">&quot;bunde module&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">server</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token string">&quot;server&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ability</span><span class="token operator">:</span> <span class="token string">&quot;data module&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>假设现在有 <code>vue、vite、server</code> 三个模块，我们试图借助这三个模块开发一些有意思的网站，可以将依赖模块借鉴 <code>IIFE</code> 引入依赖的方式以函数参数传入。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">developWeb</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">vue<span class="token punctuation">,</span> vite<span class="token punctuation">,</span> server</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> vi <span class="token operator">=</span> <span class="token function">vite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">server</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>ability<span class="token punctuation">,</span> vi<span class="token punctuation">.</span>ability<span class="token punctuation">,</span> s<span class="token punctuation">.</span>ability<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>但问题来了，依赖的模块该如何进行管理那，例如后续开发需要依赖新的模块，只能修改函数参数或者构造新的函数，这可是大忌。</p> <p>这时候，依赖注入闪亮登场，来分析一下实现要点。</p> <ul><li>可以实现依赖关系的注册(即 IOC 容器来存储所有的依赖)</li> <li>依赖注入器可以接受一个函数，注入成功后返回一个可以获取所有依赖资源的函数</li> <li>注入应保持被传递函数的作用域</li> <li>被传递的函数应该能够接受自定义参数，而不仅仅是依赖描述</li></ul> <p>下面来简单实现一个依赖注册器 <code>injector</code>，<code>injector</code> 由依赖容器、注册依赖函数、依赖注入函数三部分组组成。对于 <code>resolve</code> 函数，<code>deps</code> 代表被依赖 <code>key</code> 数组，<code>func</code> 代表需要注入依赖的函数，<code>scope</code> 代表 <code>func</code> 函数作用域。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> injector <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">dependencies</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 依赖管理中心</span>
  <span class="token function-variable function">register</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 注册依赖关系</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dependencies<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">resolve</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">deps<span class="token punctuation">,</span> func<span class="token punctuation">,</span> scope</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 依赖注入</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><code>resolve</code> 函数目的在于将 <code>deps</code> 涉及的依赖注入到 <code>func</code> 函数中，实现并不复杂。首先根据 <code>deps</code> 数组将所需的依赖从 <code>dependencies</code> 取出添加到 <code>dependModule</code> 数组中，然后在返回的函数中使用 <code>apply</code> 方法传递 <code>scope</code> 作用域及其他参数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> injector <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">dependencies</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">register</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dependencies<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">deps<span class="token punctuation">,</span> func<span class="token punctuation">,</span> scope</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dependModule <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> deps<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> d <span class="token operator">=</span> deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// 分析依赖是否存在，收集所需依赖</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dependencies<span class="token punctuation">[</span>d<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dependModule<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dependencies<span class="token punctuation">[</span>d<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>d <span class="token operator">+</span> <span class="token string">&quot;依赖不存在&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 传递函数作用域</span>
      <span class="token comment">// 接受其他参数</span>
      <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>
        scope<span class="token punctuation">,</span>
        dependModule<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>来看看使用:</p> <div class="language-js extra-class"><pre class="language-js"><code>injector<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&quot;vue&quot;</span><span class="token punctuation">,</span> vue<span class="token punctuation">)</span><span class="token punctuation">;</span>
injector<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&quot;vite&quot;</span><span class="token punctuation">,</span> vite<span class="token punctuation">)</span><span class="token punctuation">;</span>

injector<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;vue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">vue<span class="token punctuation">,</span> vite</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> vi <span class="token operator">=</span> <span class="token function">vite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>ability<span class="token punctuation">,</span> vi<span class="token punctuation">.</span>ability<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 传入其他参数</span>
injector<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;vue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">vue<span class="token punctuation">,</span> vite<span class="token punctuation">,</span> other</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> vi <span class="token operator">=</span> <span class="token function">vite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>ability<span class="token punctuation">,</span> vi<span class="token punctuation">.</span>ability<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;other&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>到这里，实现了一个简单的依赖注入，但上述实现并不完美。例如使用时需要重复所需依赖两次，此外由于附加参数的存在，还不能混淆顺序。有兴趣的朋友们可以自己完善一下。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>模块化的演变是一个特别有意思的过程，前人们探索出数十种模块化方式，各种方式有其独特特点，其中也有相互借鉴，学习这个过程可以收获良多，也可以更好地体悟当下的模块化规范。</p> <img src="/front-end-engineering-handbook/images/zaoqi_module.png" alt="微波炉3"> <p>早期的模块化方案并没有完善的解决模块化问题，随着前端工程化的推进，开源社区中陆续出现较为优秀且完善的模块化解决方案，随着 ES6 的出现，JavaScript 官方退出 ESM，标志着模块化正式进入成熟阶段，模块化已然不可或缺。</p> <p>经过早期一系列的探索，后续又诞生了那些模块化规范那，敬请期待下章《群雄逐鹿，前端模块化路在何方？》</p> <h2 id="后语"><a href="#后语" class="header-anchor">#</a> 后语</h2> <p>我是  <strong>战场小包</strong> ，一个快速成长中的小前端，希望可以和大家一起进步。</p> <p>如果喜欢小包，可以在  <strong><a href="https://github.com/zcxiaobao" target="_blank" rel="noopener noreferrer">github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong>  关注我，同样也可以关注我的小小公众号——<strong><a href="https://zcxiaobao.gitee.io/wx-demo/wx.png" target="_blank" rel="noopener noreferrer">小包学前端<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong>。</p> <p>一路加油，冲向未来!!!</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/front-end-engineering-handbook/module/esm.html">
          前端模块化未来探索
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-3b069fde data-v-349e681a><li class="level-2" data-v-3b069fde><a href="/front-end-engineering-handbook/module/origin.html#写在前面" class="sidebar-link reco-side-写在前面" data-v-3b069fde>写在前面</a></li><li class="level-2" data-v-3b069fde><a href="/front-end-engineering-handbook/module/origin.html#模块化" class="sidebar-link reco-side-模块化" data-v-3b069fde>模块化</a></li><li class="level-2" data-v-3b069fde><a href="/front-end-engineering-handbook/module/origin.html#文件划分" class="sidebar-link reco-side-文件划分" data-v-3b069fde>文件划分</a></li><li class="level-2" data-v-3b069fde><a href="/front-end-engineering-handbook/module/origin.html#命名空间" class="sidebar-link reco-side-命名空间" data-v-3b069fde>命名空间</a></li><li class="level-2" data-v-3b069fde><a href="/front-end-engineering-handbook/module/origin.html#iife" class="sidebar-link reco-side-iife" data-v-3b069fde>IIFE</a></li><li class="level-2" data-v-3b069fde><a href="/front-end-engineering-handbook/module/origin.html#依赖注入" class="sidebar-link reco-side-依赖注入" data-v-3b069fde>依赖注入</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/origin.html#依赖倒置原则" class="sidebar-link reco-side-依赖倒置原则" data-v-3b069fde>依赖倒置原则</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/origin.html#控制反转" class="sidebar-link reco-side-控制反转" data-v-3b069fde>控制反转</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/origin.html#依赖注入-2" class="sidebar-link reco-side-依赖注入-2" data-v-3b069fde>依赖注入</a></li><li class="level-3" data-v-3b069fde><a href="/front-end-engineering-handbook/module/origin.html#实现" class="sidebar-link reco-side-实现" data-v-3b069fde>实现</a></li><li class="level-2" data-v-3b069fde><a href="/front-end-engineering-handbook/module/origin.html#总结" class="sidebar-link reco-side-总结" data-v-3b069fde>总结</a></li><li class="level-2" data-v-3b069fde><a href="/front-end-engineering-handbook/module/origin.html#后语" class="sidebar-link reco-side-后语" data-v-3b069fde>后语</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-2a01419c data-v-2a01419c><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-2a01419c><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-2a01419c></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-2a01419c></path></svg></div></div></div>
    <script src="/front-end-engineering-handbook/assets/js/app.a64d5fad.js" defer></script><script src="/front-end-engineering-handbook/assets/js/3.e17cbad9.js" defer></script><script src="/front-end-engineering-handbook/assets/js/1.45b034b9.js" defer></script><script src="/front-end-engineering-handbook/assets/js/15.1a4bb958.js" defer></script>
  </body>
</html>
